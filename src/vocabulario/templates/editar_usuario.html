{% extends 'base.html' %}
{% load static tailwind_tags %}
{% load widget_tweaks %}

{% block content %}
<div class="flex flex-col items-center justify-center w-full px-2">
  <div class="w-full max-w-2xl bg-slate-900 bg-opacity-95 rounded-2xl shadow-2xl p-6 sm:p-10 md:p-14 my-12 flex flex-col">
    <h2 class="text-2xl sm:text-3xl font-extrabold text-blue-200 mb-2 text-center">Editar perfil</h2>
    <p class="text-blue-100 mb-6 text-center text-base sm:text-lg">Actualiza tus datos o cambia tu foto.</p>

    <form method="post" enctype="multipart/form-data" class="space-y-6 mb-8">
      {% csrf_token %}
      <div class="flex flex-col items-center gap-2">
        <div class="w-24 h-24 sm:w-28 sm:h-28 rounded-full overflow-hidden border-4 border-blue-400 shadow-lg bg-slate-800">
          <img
            src="{% if user.perfil.imagen %}{{ user.perfil.imagen.url }}{% else %}{% static 'img/profilepicture.png' %}{% endif %}"
            alt="Avatar"
            class="object-cover w-full h-full"
          />
        </div>
        <label for="id_imagen" class="text-blue-100 font-semibold text-sm mb-2">Cambiar foto de perfil</label>
        {{ perfil_form.imagen|add_class:"cursor-pointer bg-slate-800 text-white rounded px-3 py-2 text-sm w-full focus:outline-none focus:ring-2 focus:ring-blue-400 file:bg-blue-600 file:text-white file:rounded file:px-3 file:py-2" }}
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="flex flex-col gap-1">
          <label for="id_first_name" class="text-blue-100 font-semibold text-sm">Nombre</label>
          {{ form.first_name|add_class:"bg-slate-800 text-white rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 w-full" }}
        </div>
        <div class="flex flex-col gap-1">
          <label for="id_last_name" class="text-blue-100 font-semibold text-sm">Apellidos</label>
          {{ form.last_name|add_class:"bg-slate-800 text-white rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 w-full" }}
        </div>
      </div>
      <div class="flex flex-col gap-1">
        <label for="id_email" class="text-blue-100 font-semibold text-sm">Correo electrónico</label>
        {{ form.email|add_class:"bg-slate-800 text-white rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 w-full" }}
      </div>
      <button type="submit"
              name="guardar_datos"
              class="cursor-pointer w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg shadow transition text-base">
        Guardar cambios
      </button>
    </form>

    <hr class="border-slate-700 mb-8">

    <h3 class="text-xl text-blue-200 mb-4 text-center">Cambiar contraseña</h3>
    <form method="post" class="space-y-4 mb-4">
      {% csrf_token %}
      {% if password_form.errors %}
        <div class="bg-red-700 text-white rounded p-3 mb-2 text-sm">
          {% for field in password_form %}
            {% for error in field.errors %}
              <div>{{ error }}</div>
            {% endfor %}
          {% endfor %}
          {% for error in password_form.non_field_errors %}
            <div>{{ error }}</div>
          {% endfor %}
        </div>
      {% endif %}
      <div class="flex flex-col gap-1">
        <label for="id_old_password" class="text-blue-100 mt-2 font-semibold text-sm">Contraseña actual</label>
        {{ password_form.old_password|add_class:"bg-slate-800 text-white rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 w-full" }}
      </div>
      <div class="flex flex-col gap-1">
        <label for="id_new_password1" class="text-blue-100 mt-2 font-semibold text-sm">Nueva contraseña</label>
        {{ password_form.new_password1|add_class:"bg-slate-800 text-white rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 w-full" }}
      </div>
      <div class="flex flex-col gap-1">
        <label for="id_new_password2" class="text-blue-100 mt-2 font-semibold text-sm">Repite la nueva contraseña</label>
        {{ password_form.new_password2|add_class:"bg-slate-800 text-white rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 w-full" }}
      </div>
      <button type="submit"
              name="cambiar_password"
              class="cursor-pointer w-full bg-blue-600 hover:bg-blue-700 mt-8 text-white font-bold py-2 rounded-lg transition text-base">
        Cambiar contraseña
      </button>
    </form>
    <form action="{% url 'logout' %}" method="post" class="mt-6">
      {% csrf_token %}
      <button type="submit"
              class="cursor-pointer w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded-lg transition text-base">
        Cerrar sesión
      </button>
    </form>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const main = document.querySelector('main');
    if (main) {
      main.scrollTop = 0;
    } else {
      window.scrollTo(0, 0);
    }
  });
</script>
{% endblock %}
